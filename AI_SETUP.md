# AI 行程生成功能配置指南

## 概述
TravelMaker 现已集成 Google Gemini AI 功能，可以自动生成行程建议。

## 安装和配置

### 1. 获取 Gemini API Key

1. 访问 [Google AI Studio](https://aistudio.google.com/app/apikey)
2. 点击 "Create API Key" 按钮
3. 选择或创建一个项目
4. 复制生成的 API Key

> **免费配额**: Google Gemini API 提供每分钟 60 个请求的免费配额，足以用于个人测试

### 2. 配置环境变量

1. 在项目根目录创建 `.env` 文件（如果还没有的话）
2. 添加以下内容：

```
VITE_GEMINI_API_KEY=your_api_key_here
```

3. 将 `your_api_key_here` 替换为你的实际 API Key

### 3. 重启开发服务器

```bash
npm run dev
```

## 使用方法

### 生成 AI 建议行程

1. 创建一个行程并填写地点和日期
2. 在行程页面（TripItinerary），金額統計下方会看到 "🤖 AI 智能推荐行程" 和 "📋 查看缓存" 按钮
3. 点击 AI 按钮，系统会：
   - 自动检查是否有该地点和日期的缓存数据
   - 如果有缓存，直接显示之前生成的建议（速度快）
   - 如果没有缓存，调用 Gemini AI 生成新建议
   - 新生成的建议会自动保存到缓存（30天有效期）

### 查看和管理缓存

1. 点击 "📋 查看缓存" 按钮查看所有保存的行程建议
2. 支持的操作：
   - **选择缓存** - 直接点击缓存项，快速加载该地点的行程建议
   - **删除缓存** - 点击 🗑️ 图标删除不需要的缓存

### 选择和添加建议

1. 展开你感兴趣的日期
2. 勾选想要添加的活动
3. 点击 "添加选中的活动" 按钮
4. 选中的活动会被自动添加到你的行程中

## 缓存工作原理

- **缓存 Key**: 使用地点 + 开始日期 + 结束日期组合作为缓存标识
- **存储位置**: 浏览器 localStorage（本地存储，不上传到服务器）
- **缓存时长**: 30 天
- **缓存内容**: 完整的行程建议数据（包括所有活动详情）
- **大小限制**: 浏览器 localStorage 通常有 5-10MB 的限制（足够存储数千个行程建议）

## 优势

✅ **减少 API 调用** - 同一地点和日期的建议只需生成一次
✅ **更快的加载速度** - 从缓存加载比 AI 生成快 10 倍
✅ **离线支持** - 可以在没有网络的情况下查看已缓存的建议
✅ **省钱** - 降低 API 配额的消耗
✅ **智能管理** - 自动过期机制和手动删除选项

## 缓存示例

假设你为 "东京 2025-05-01 ~ 2025-05-05" 生成了行程建议：

1. **第一次**：点击 AI 按钮 → 调用 API → 生成建议 → 显示结果 → 自动保存到缓存（耗时 5-10 秒）

2. **第二次**：点击 AI 按钮 → 检查缓存 → 找到匹配的数据 → 直接显示结果（耗时 <1 秒）

3. **查看缓存**：点击 "📋 查看缓存" → 可以看到之前为东京生成的建议 → 可以点击快速加载或删除

## 功能特性

- ✅ 基于地点和日期的智能推荐
- ✅ 考虑已有活动，避免时间冲突
- ✅ 包含预估费用、地点、分类等详细信息
- ✅ 支持多选，自由组合活动
- ✅ 实时显示已选活动的费用总计
- ✅ 响应式设计，支持各种屏幕尺寸
- ✅ **智能缓存系统** - 自动保存生成的建议，同一地点重复生成时秒速加载
- ✅ **缓存管理** - 查看、选择、删除历史建议
- ✅ **30天自动过期** - 旧的建议会自动清理

## API 限制

- **免费配额**: 每分钟 60 次请求
- **Token 限制**: 每次请求最多 4096 token
- **响应时间**: 通常 3-10 秒

## 故障排除

### 问题: "Gemini API key not configured"
**解决方案**: 
- 检查 `.env` 文件中的 `VITE_GEMINI_API_KEY` 是否正确设置
- 重启开发服务器

### 问题: "API quota exceeded"
**解决方案**:
- 等待 1 分钟后重试
- 查看你的请求频率

### 问题: "Invalid response format from Gemini"
**解决方案**:
- 这可能是 Gemini API 返回了非预期格式的响应
- 检查你的网络连接
- 稍后重试

## 隐私说明

- 行程信息（地点、日期、活动详情）会被发送到 Google Gemini API
- 请不要在行程中包含敏感个人信息
- Google 的 API 有其隐私政策，详见 [Google Privacy Policy](https://policies.google.com/privacy)

## 下一步优化

未来计划的改进：
- [ ] 支持更多 AI 服务（OpenAI, Claude 等）
- [ ] 本地存储建议历史
- [ ] 自定义 AI 提示词
- [ ] 支持多种语言的建议生成
